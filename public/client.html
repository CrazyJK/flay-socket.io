<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js" integrity="sha384-fKnu0iswBIqkjxrhQCTZ7qlLHOFEgNkRmK2vaO/LbTZSXdJfAu6ewRBdwHPhBo/H" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script>
        const SOCKJS_URL = "http://123.212.190.177:8090"

        const connect = () => {
            const socket = io();
            socket
                .on('connect', () => {
                    console.log('socket connect by id', socket.id);
                    socket.emit('adduser', document.getElementById('empcode').value);
                })
                .on('disconnect', () => {
                    console.log('socket disconnect', socket.id);
                })
                .on('updateusers', (usernames) => {
                    console.log('updateusers', usernames);
                    const names = Object.values(usernames);
                    $('#users').empty();
                    names.forEach((name) => {
                        $(`<li>${name}</li>`).on('click', (e) => {
                            $('#toId').val($(e.target).text());
                        }).appendTo($('#users'));
                    });
                })
                .on('updatemessage', (from, message) => {
                    console.log(`updatemessage from ${from} => ${message}`);
                    $('#fromMessages').prepend(`
                        <div class="alert alert-info">
                            <h4 class="alert-heading">${from}</h4>
                            <p>${message}</p>
                        </div>`);
                });
        };
        const send = () => {
            const id = $("#toId").val();
            const data = $('#toMessage').val();
            $.ajax({
                type: "POST",
                url: SOCKJS_URL + "/webNotification",
                data: "id=" + id + "&data=" + data,
                success: function (msg) {
                    console.log(msg);
                }
            });
        };
    </script>
</head>

<body>
    <div class="container-fluid">
        <div class="input-group my-3">
            <input type="text" id="empcode" placeholder="사번" class="form-control w-auto" />
            <button onclick="connect()" class="btn btn-outline-primary">Connect</button>
        </div>
        <div class="row">
            <div class="col-4">
                <h4>Connected Users</h4>
                <ul id="users"></ul>
            </div>
            <div class="col-4">
                <h4>send webNotification</h4>
                <div>
                    <label for="toId">
                        To
                    </label>
                    <input type="text" id="toId" class="form-control" />
                </div>
                <div class="mb-2">
                    <label for="toMessage">
                        Message
                    </label>
                    <input type="text" id="toMessage" class="form-control" />
                </div>
                <button onclick="send()" class="btn btn-outline-success">Send</button>
            </div>
            <div class="col-4">
                <h4>Received</h4>
                <div id="fromMessages">
                </div>
            </div>
        </div>
    </div>
</body>

</html>